<!DOCTYPE html>
<!--[if lt IE 9 ]> <html lang="zxx" dir="ltr" class="no-js ie-old"> <![endif]-->
<!--[if IE 9 ]> <html lang="zxx" dir="ltr" class="no-js ie9"> <![endif]-->
<!--[if IE 10 ]> <html lang="zxx" dir="ltr" class="no-js ie10"> <![endif]-->
<!--[if (gt IE 10)|!(IE)]><!-->
<html lang="zxx" dir="ltr" class="no-js">
<!--<![endif]-->
{% load static %}
{% load widget_tweaks %}
<head>
    <!-- ––––––––––––––––––––––––––––––––––––––––– -->
    <!-- META TAGS                                 -->
    <!-- ––––––––––––––––––––––––––––––––––––––––– -->
    <meta charset="utf-8">
    <!-- Always force latest IE rendering engine -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Mobile specific meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!-- ––––––––––––––––––––––––––––––––––––––––– -->
    <!-- PAGE TITLE                                -->
    <!-- ––––––––––––––––––––––––––––––––––––––––– -->
    <title>Klip | Coupons, Deals, Discounts </title>

    <!-- ––––––––––––––––––––––––––––––––––––––––– -->
    <!-- SEO METAS                                 -->
    <!-- ––––––––––––––––––––––––––––––––––––––––– -->
    <meta name="description" content="brief description here">
    <meta name="keywords" content="insert, keywords, here">
    <meta name="robots" content="index, follow">
    <meta name="author" content="CODASTROID">
    <!-- ––––––––––––––––––––––––––––––––––––––––– -->
    <!-- PAGE FAVICON                              -->
    <!-- ––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="apple-touch-icon" href="{% static 'main_app/images/favicon/apple-touch-icon.png' %}">
    <link rel="icon" href="{% static 'main_app/images/favicon/favicon.ico' %}">

    <!-- ––––––––––––––––––––––––––––––––––––––––– -->
    <!-- GOOGLE FONTS                              -->
    <!-- ––––––––––––––––––––––––––––––––––––––––– -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,600" rel="stylesheet">

    <style>
        @font-face {
    font-family: "georgina";
    src: url("{% static 'main_app/fonts/GeorginaDemo-Regular.eot' %}");
    src: url("{% static 'main_app/fonts/GeorginaDemo-Regular.eot?#iefix' %}") format("embedded-opentype"),
         url("{% static 'main_app/fonts/GeorginaDemo-Regular.woff' %}") format("woff"),
         url("{% static 'main_app/fonts/GeorginaDemo-Regular.ttf'  %}") format("truetype");
    font-weight: normal;
    font-style: normal;
    }
    </style>
    <!-- ––––––––––––––––––––––––––––––––––––––––– -->
    <!-- Include CSS Filess                        -->
    <!-- ––––––––––––––––––––––––––––––––––––––––– -->
    <!-- Bootstrap -->
    <link href="{% static 'main_app/css/bootstrap.min.css' %}" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="{% static 'main_app/vendors/font-awesome/css/font-awesome.min.css' %}" rel="stylesheet">

    <!-- Linearicons -->
    <link href="{% static 'main_app/vendors/linearicons/css/linearicons.css' %}" rel="stylesheet">

    <!-- Dropdown -->
    <link rel="stylesheet" href="{% static 'main_app/vendors/sweet-dropdown/dist/min/jquery.sweet-dropdown.min.css' %}" />

    <!-- Template Stylesheet -->
    <link href="{% static 'main_app/css/base.css' %}" rel="stylesheet">
    <link href="{% static 'main_app/css/style.css' %}" rel="stylesheet">


</head>

<body id="body" class="is-home wide-layout preloader-active">

    <!--[if lt IE 9]>
        <p class="browserupgrade alert-error">
        	You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.
        </p>
        <![endif]-->

        <noscript>
            <div class="noscript alert-error">
                For full functionality of this site it is necessary to enable JavaScript. Here are the <a href="http://www.enable-javascript.com/" target="_blank">
                instructions how to enable JavaScript in your web browser</a>.
            </div>
        </noscript>

        <!-- ––––––––––––––––––––––––––––––––––––––––– -->
        <!-- PRELOADER                                 -->
        <!-- ––––––––––––––––––––––––––––––––––––––––– -->
        <!-- Preloader -->
        <div id="preloader" class="preloader">
            <div class="loader-cube">
                <div class="loader-cube__item1 loader-cube__item"></div>
                <div class="loader-cube__item2 loader-cube__item"></div>
                <div class="loader-cube__item4 loader-cube__item"></div>
                <div class="loader-cube__item3 loader-cube__item"></div>
            </div>
        </div>
        <!-- End Preloader -->
        <!-- ––––––––––––––––––––––––––––––––––––––––– -->
        <!-- WRAPPER                                   -->
        <!-- ––––––––––––––––––––––––––––––––––––––––– -->
        <div id="pageWrapper" class="page-wrapper">
            <!-- –––––––––––––––[ HEADER ]––––––––––––––– -->
            <header id="mainHeader" class="main-header">
            

             <!-- Top Bar -->
             <div class="top-bar bg-blue">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 col-md-4 is-hidden-sm-down">
                            <ul class="nav-top nav-top-left list-inline t-left">
                                <li><a href="{% url 'about_us' %}"><i class="fa fa-question-circle"></i>About</a>
                                </li>
                                <li><a href="{% url 'contact_us' %}"><i class="fa fa-support"></i>Contact Us</a>
                                </li>
                            </ul>
                        </div>
                        <div class="col-sm-12 col-md-8">
                            <ul class="nav-top nav-top-right list-inline t-xs-center t-md-right">
                                {% if user.is_authenticated %}
                                <li>
                                    <a href="#"><i class="fa fa-account"></i>{{ user.first_name }} {{ user.last_name }} {% if request.user.is_superuser %} {{ user.username }} {% endif %}<i class="fa fa-caret-down"></i></a>
                                    <ul>
                                        <li><a href="{% url 'users_app:profile' %}">{% if user.profile.user_type == 1 %}Dashboard{% else %}Profile{% endif %}</a>
                                        </li>
                                        <!--li><a href="{% url 'users_app:profile' %}#wallet">wallet</a>
                                        </li-->
                                        <li><a href="{% url 'logout' %}">Sign Out</a>
                                        </li>
                                    </ul>
                                </li>
                                {% else %}
                                <li><a href="{% url 'login' %}"><i class="fa fa-lock"></i>Sign In</a>
                                </li>
                                <li><a href="{% url 'register' %}"><i class="fa fa-user"></i>Sign Up</a>
                                </li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Top Bar -->

            <!-- Header Header -->
            <div class="header-header bg-white">
                <div class="container">
                    <div class="search-line">
                        <div class="brand t-center valign-middle">
                            <a href="{% url 'index' %}" class="logo">
                                <span>Klip</span>
                            </a>
                        </div>
                        <div class="header-search">
                            <div class="">
                                <div class="col-xs-12 mtb-40">
                                    <form class="search-form" action="{% url 'map_view' %}" method="post" >
                                        {%  csrf_token %}
                                        <div class="input-group">
                                            <div class="search-input-wrapper">
                                                {% render_field form.location class="form-control input-lg search-input" id="searchTextField" style="background-color: rgba(255,255,255, 0.9)" placeholder="Enter location ..." required="required " %}
                                                <button id="current" class="btn btn-lg btn-search" tittle="Your location">
                                                        <i class="fa fa-map-marker font-16"></i>
                                                </button>
                                            </div>
                                            <!--input type="text" class="form-control input-lg search-input" style="background-color: rgba(255,255,255, 0.9)" placeholder="Enter location ..." required="required"-->
                                            <div class="input-group-btn">
                                                <div class="input-group">
                                                    <select class="form-control input-lg search-select" style="background-color: rgba(255,255,255,0.9)">
                                                        <option>Select Type</option>
                                                        <option>Indica</option>
                                                        <option>Sativa</option>
                                                        <option>Hybrid</option>
                                                        <option>CBD</option>
                                                        <option>Concentrates</option>
                                                        <option>Edibles</option>
                                                    </select>
                                                    <div class="input-group-btn">
                                                        <button type="submit" class="btn btn-lg btn-search btn-block" style="margin-left: 0;">
                                                            <i class="fa fa-search font-16"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Header Header -->

        </header>
        <!-- –––––––––––––––[ HEADER ]––––––––––––––– -->

        <!-- –––––––––––––––[ PAGE CONTENT ]––––––––––––––– -->

        <main id="mainContent" class="main-content main-content-home">
        {% if not user.is_authenticated %}
            <div class="page-container ptb-10">
                <div class="container">
                    <h1 style="text-align: center; padding-top: 35px">Claim and save!</h1>
                    <div class="section explain-process-area ptb-60">
                        <div class="row row-rl-10">               
                            <div class="col-xs-offset-2 col-xs-8 col-sm-offset-0 col-sm-4 col-md-4 col-lg-4 mt-xs-20">
                                <div class="item panel prl-15 ptb-20">
                                    <div class="row row-rl-5">
                                        <div class="col-xs-offset-2 col-xs-8">
                                            <img class="pr-10" src="{% static 'main_app/images/icons/tablet.png' %}" alt="" width="166">
                                        </div>
                                        <div class="col-xs-12">
                                            <h5 class="mb-10 pt-40">Browse the best deals near you</h5>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-offset-2 col-xs-8 col-sm-offset-0 col-sm-4 col-md-4 col-lg-4 mt-xs-20">
                                <div class="item panel prl-15 ptb-20">
                                    <div class="row row-rl-5">
                                        <div class="col-xs-offset-2 col-xs-8">
                                            <img class="pr-10" src="{% static 'main_app/images/icons/online-shop-6.png' %}" alt="" width="166">
                                        </div>
                                        <div class="col-xs-12">
                                            <h5 class="mb-10 pt-40">Claim the best deals. It gets added to your wallet</h5>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-offset-2 col-xs-8 col-sm-offset-0 col-sm-4 col-md-4 col-lg-4 mt-xs-20">
                                <div class="item panel prl-15 ptb-20">
                                    <div class="row row-rl-5">
                                        <div class="col-xs-offset-2 col-xs-8">
                                            <img class="pr-10" src="{% static 'main_app/images/icons/points.png' %}" alt="" width="166">
                                        </div>
                                        <div class="col-xs-12">
                                            <h5 class="mb-10 pt-40">More rewards for each used deal</h5>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="big-button-wrapper">
                        <form action="{% url 'register' %}"><button class="btn btn-big mt-30">Sign Up</button></form>
                    </div>

                    <section class="section dispensary-area pb-60 pt-30 t-center">
                        <div class="newsletter-form">
                            <h3 class="mb-40">Are you a dispensary or wholesaler<br>that want to sell deals?</h3>
                                <a class="btn btn-big" href="{% url 'register_dispensary' %}" type="submit">Learn How</a>
                            </div>
                        </section>
                    </div>
                </div>
            {% else %}
            <div class="page-container ptb-10 mrl-15">
                    <section class="section deals-area pt-30">
                        <ul class="categories-mnu mb-10 js-categories">
                            <li id="1">Indica</li>
                            <li id="2">Sativa</li>
                            <li id="3">Hybrid</li>
                            <li id="4">Concentrates</li>
                            <li id="5">Edibles</li>
                            <li id="6">CBD</li>
                        </ul>
                        <!-- Page Control -->
                        <header class="page-control panel ptb-15 prl-20 pos-r mb-30">
                            <!-- List Control View -->
                            <ul class="list-control-view list-inline">
                                <li>
                                    <select id="js-select-view" class="form-control input-sm select-view prl-25">
                                        <option value="0" >Map View</option>
                                        <option value="1" >List View</option>
                                    </select>
                                </li>
                            </ul>
                            <!-- End List Control View -->

                            <div class="right-10 pos-tb-center">
                                <select class="form-control input-sm" id="js-switch-sort">
                                    <option value="0">Featured</option>
                                    <option value="1">Just added</option>
                                    <option value="2">Most claimed</option>
                                </select>
                            </div>
                        </header>
                        <!-- End Page Control -->


                        <!-- MAP -->
                        <div id="js-map-view" class="page-content category-map-content">
                            <div class="page-sidebar map_sidebar">
                                <!-- Blog Sidebar -->
                                <div id="side_bar">
                                </div>
                                <!-- End Blog Sidebar -->
                            </div>
                            <div id="map" style="display: inline-block; height: 100%; width: 100%; overflow: hidden"></div>
                        </div>



                        <div class="row row-masnory row-tb-20 " id="js-list-view" style="display: none">

                            <div class="col-sm-6 col-lg-4">
                                <div class="deal-single panel">
                                    <figure class="deal-thumbnail embed-responsive embed-responsive-16by9" data-bg-img="assets/images/deals/deal_01.jpg" style="background-image: url(https://friday-theme.firebaseapp.com/assets/images/deals/deal_01.jpg);">
                                        <div class="label-discount left-20 top-15">-50%</div>
                                        <div class="time-left bottom-15 right-20 font-md-14">
                                            <span>
		                            <i class="ico fa fa-clock-o mr-10"></i>
		                            <span class="t-uppercase" data-countdown="2019/09/01 01:30:00">103 Weeks 06 Days 12 : 43 : 45</span>
		                        </span>
                                        </div>
                                        <div class="deal-store-logo">
                                            <img src="assets/images/brands/brand_01.jpg" alt="">
                                        </div>
                                    </figure>
                                    <div class="bg-white pt-20 pl-20 pr-15">
                                        <div class="pr-md-10">
                                            <div class="demo mb-15 t-center">
                                                <button class="like like-custom" disabled=""><i class="fa fa-thumbs-up is-inline-block"></i> Likes <span class="likes">0</span> </button>
                                                <button class="dislike dislike-custom" disabled=""><i class="fa fa-thumbs-down is-inline-block"></i> Dislikes <span class="dislikes">0</span> </button>
                                            </div>
                                            <h3 class="deal-title mb-10">
		                            <a href="deal_single.html">The Crash Bad Instant Folding Twin Bed</a>
		                        </h3>
                                            <ul class="deal-meta list-inline mb-10 color-mid">
                                                <li><i class="ico fa fa-map-marker mr-10"></i>United State</li>
                                                <li><i class="ico fa fa-shopping-basket mr-10"></i>120 Bought</li>
                                            </ul>
                                            <p class="text-muted mb-20">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Laboriosam numquam nostrum.</p>
                                        </div>
                                        <div class="deal-price pos-r mb-15">
                                            <h3 class="price ptb-5 text-right"><span class="price-sale">$300.00</span>$150.00</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Page Pagination -->
                        <!--div class="page-pagination text-center mt-30 p-10 panel">
                            <nav>
                                <!-- Page Pagination >
                                <ul class="page-pagination">
                                    <li><a class="page-numbers previous" href="#">Previous</a>
                                    </li>
                                    <li><a href="#" class="page-numbers">1</a>
                                    </li>
                                    <li><span class="page-numbers current">2</span>
                                    </li>
                                    <li><a href="#" class="page-numbers">3</a>
                                    </li>
                                    <li><a href="#" class="page-numbers">4</a>
                                    </li>
                                    <li><span class="page-numbers dots">...</span>
                                    </li>
                                    <li><a href="#" class="page-numbers">20</a>
                                    </li>
                                    <li><a href="#" class="page-numbers next">Next</a>
                                    </li>
                                </ul>
                                <!-- End Page Pagination -->
                            <!--/nav>
                        </div>
                        <!-- End Page Pagination -->

                    </section>

                </div>
                {% endif %}

            </main>
        <!-- –––––––––––––––[ FOOTER ]––––––––––––––– -->
        <footer id="mainFooter" class="main-footer ptb-20">
            <div class="container">
                <div class="row">
                    <div>
                        <p style="margin-top: 0;">Copyright &copy; 2017 . All rights reserved.</p>
                    </div>
                    <div class="payment-methods t-center mt-30" style="opacity: 0.8;">
                            <span><img src="{% static 'main_app/images/icons/payment/paypal.jpg' %}" alt=""></span>
                            <span><img src="{% static 'main_app/images/icons/payment/visa.jpg' %}" alt=""></span>
                            <span><img src="{% static 'main_app/images/icons/payment/mastercard.jpg' %}" alt=""></span>
                            <span><img src="{% static 'main_app/images/icons/payment/discover.jpg' %}" alt=""></span>
                            <span><img src="{% static 'main_app/images/icons/payment/american.jpg' %}" alt=""></span>
                    </div>

                </div>
            </div>
        </footer>
    <!-- –––––––––––––––[ END FOOTER ]––––––––––––––– -->
</div>
<!-- ––––––––––––––––––––––––––––––––––––––––– -->
<!-- END WRAPPER                               -->
<!-- ––––––––––––––––––––––––––––––––––––––––– -->


<!-- ––––––––––––––––––––––––––––––––––––––––– -->
<!-- BACK TO TOP                               -->
<!-- ––––––––––––––––––––––––––––––––––––––––– -->
<div id="backTop" class="back-top is-hidden-sm-down">
    <i class="fa fa-angle-up" aria-hidden="true"></i>
</div>

<!-- ––––––––––––––––––––––––––––––––––––––––– -->
<!-- SCRIPTS                                   -->
<!-- ––––––––––––––––––––––––––––––––––––––––– -->

<!-- (!) Placed at the end of the document so the pages load faster -->

<!-- ––––––––––––––––––––––––––––––––––––––––– -->
<!-- Initialize jQuery library                 -->
<!-- ––––––––––––––––––––––––––––––––––––––––– -->
<script src="{% static 'main_app/js/jquery-1.12.3.min.js' %}"></script>

<!-- ––––––––––––––––––––––––––––––––––––––––– -->
<!-- Latest compiled and minified Bootstrap    -->
<!-- ––––––––––––––––––––––––––––––––––––––––– -->
<script type="text/javascript" src="{% static 'main_app/js/bootstrap.min.js' %}"></script>

<!-- ––––––––––––––––––––––––––––––––––––––––– -->
<!-- JavaScript Plugins                        -->
<!-- ––––––––––––––––––––––––––––––––––––––––– -->
<!-- (!) Include all compiled plugins (below), or include individual files as needed -->

<!-- Modernizer JS -->
<script src="{% static 'main_app/vendors/modernizr/modernizr-2.6.2.min.js' %}"></script>

<!-- Owl Carousel -->
<script type="text/javascript" src="{% static 'main_app/vendors/owl-carousel/owl.carousel.min.js' %}"></script>

<!-- Dropdown -->
<script src="{% static 'main_app/vendors/sweet-dropdown/dist/min/jquery.sweet-dropdown.min.js' %}"></script>

<!-- FlexSlider -->
<script type="text/javascript" src="{% static 'main_app/vendors/flexslider/jquery.flexslider-min.js' %}"></script>

<!-- Coutdown -->
<script type="text/javascript" src="{% static 'main_app/vendors/countdown/jquery.countdown.js' %}"></script>

<!-- ––––––––––––––––––––––––––––––––––––––––– -->
<!-- Custom Template JavaScript                   -->
<!-- ––––––––––––––––––––––––––––––––––––––––– -->
<script type="text/javascript" src="{% static 'main_app/js/main.js' %}"></script>
<script>
    function initialize() {

    var input = document.getElementById('searchTextField');
    var autocomplete = new google.maps.places.Autocomplete(input);
    }

    //google.maps.event.addDomListener(window, 'load', initialize);
</script>
<script>
    var side_bar_html = "";
    var list_view_html = "";
    var markers = [];
    var deals = [];
    var newd = [];
    var featured = [];
    var map;

    function offsetCenter(latlng, offsetx, offsety) {

    // latlng is the apparent centre-point
    // offsetx is the distance you want that point to move to the right, in pixels
    // offsety is the distance you want that point to move upwards, in pixels
    // offset can be negative
    // offsetx and offsety are both optional

    var scale = Math.pow(2, map.getZoom());

    var worldCoordinateCenter = map.getProjection().fromLatLngToPoint(latlng);
    var pixelOffset = new google.maps.Point((offsetx/scale) || 0,(offsety/scale) ||0);

    var worldCoordinateNewCenter = new google.maps.Point(
        worldCoordinateCenter.x - pixelOffset.x,
        worldCoordinateCenter.y + pixelOffset.y
    );

    var newCenter = map.getProjection().fromPointToLatLng(worldCoordinateNewCenter);

    map.setCenter(newCenter);

    }

    function myclick(i) {
      google.maps.event.trigger(markers[i], "click");
    }

    function createMarker(position, name, city, state, dispensary, bought, image_url, likes, dislikes, deal_url, price, old_price, info_html) {

        var marker = new google.maps.Marker({
          position: position,
          map: map
        });

        var infowindow = new google.maps.InfoWindow({
          content: info_html
        });


        marker.addListener('click', function() {
            infowindow.open(map, marker);
            map.setCenter(marker.position);
            offsetCenter(marker.position, 200, 50)
          });

        markers.push(marker);
        side_bar_html += '<a href="javascript:myclick(' + (markers.length-1) + ')"><div class="map_sidebar_item"><div class="store_img_wrapper" style="background-image: url('+ image_url +')"></div><div class="map_sidebar_content1">' +
            '<div class="p-wrapper" style="padding-top: 3px;width: 296px; height: 55px; line-height: 1.4; font-size: 17px; font-weight: 500;"><p>' + name + '</p></div>' +
            '<ul class="deal-meta list-inline color-mid" style="font-weight: 500"> <li><i class="ico fa fa-globe"></i> '+ dispensary +'</li><li><i class="ico fa fa-map-marker"></i> '+ city +', '+ state +'</li>' +
            '<li><i class="ico fa fa-shopping-basket"></i>' + bought + ' Bought</li></ul></div></div></a>';


        list_view_html += '<div class="col-xs-offset-1 col-xs-10 col-sm-offset-0 col-sm-4 col-md-4 col-lg-3"> <div class="deal-single panel">' +
                        '<figure class="deal-thumbnail embed-responsive embed-responsive-16by9" data-bg-img="'+ image_url +' " style="background-image: url('+ image_url +');">' +
                            '<div class="time-left bottom-15 right-20 font-md-14">' +
                               ' <span> ' +
                        '<i class="ico fa fa-clock-o mr-10"></i> ' +
                    '</span>' +
                            '</div>' +

                        '</figure> ' +
                        '<div class="bg-white pt-20 pl-20 pr-15"> ' +
                           ' <div class="pr-md-10"> ' +
                              '  <div class="demo mb-15 t-center"> '+
                                   ' <button class="like like-custom" disabled=""><i class="fa fa-thumbs-up is-inline-block"></i> Likes '+
                                      '  <span class="likes">'+ likes +'</span> '+
                                    '</button>'+
                                    '<button class="dislike dislike-custom" disabled=""><i class="fa fa-thumbs-down is-inline-block"></i> Dislikes '+
                                        '<span class="dislikes">'+ dislikes +'</span> '+
                                    '</button> '+
                               ' </div> '+
                               ' <h3 class="deal-title mb-10"> '+
                       ' <a href="' + deal_url + '">'+ dispensary +'</a> '+
                    '</h3> '+
                              '  <ul class="deal-meta list-inline mb-10 color-mid"> '+
                                  '  <li><i class="ico fa fa-map-marker mr-10"></i>'+ state +','+ city +'</li> '+
                                   ' <li><i class="ico fa fa-shopping-basket mr-10"></i>' + bought + ' Bought</li> '+
                               ' </ul> '+
                               ' <p class="text-muted mb-20">' + name + '</p> '+
                            '</div> '+
                            '<div class="deal-price pos-r mb-15"> '+
                               ' <h3 class="price ptb-5 text-right"><span class="price-sale">$'+ old_price +'</span>$'+ price +'</h3> '+
                            '</div> ' +
                        '</div> '+
                   ' </div>'+
                '</div>'
      }

    function getDeals(location, callback){

      $.ajax({
        url: '{% url 'deals_around' %}',
        type: 'post',
        data: {location: location},
        success: function(data){
           callback(data);

        }

      });
    }
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(initMap);
        } else {
            console.log('Geolocation is not allowed');
        }
        var input = document.getElementById('searchTextField');
        var autocomplete = new google.maps.places.Autocomplete(input);
    }

    function initMap(position) {
        console.log(position.coords.latitude);
        var center = {lat: position.coords.latitude, lng: position.coords.longitude};

        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 10,
            center: center,
            disableDefaultUI: true
        });


        var location = position.coords.latitude + ' ' + position.coords.longitude;



        getDeals(location, function(data){
            console.log(data);
            deals = data.deals;
            newd = deals;
            deals.forEach(function(deal, i, deals) {
                if (deal.type == '1') {
                    featured.push(deal);
                    createMarker({
                        lat: deal.lat,
                        lng: deal.lng
                    }, deal.title, deal.dispensary_city, deal.dispensary_state, deal.dispensary, deal.bought, deal.image_url, deal.likes, deal.dislikes, deal.deal_url, deal.price, deal.old_price, '<div style="min-width:270px"><a target="_blank" href="' + deal.deal_url + '" style="width: 100%; height: 100%; display: inline-block" ><img src="' + deal.image_url + '" alt="Logo" align="left" style="width: 80px; height: 80px"> <div class="p-wrapper" style="text-overflow:ellipsis; overflow:hidden; white-space:nowrap; max-width: 500px; display: inline-block; padding-left: 13px; vertical-align: top; padding-bottom: 8px; font-size: 20px">' + deal.title + '</div><br><span style="text-transform: uppercase; padding-left: 13px; font-weight: 400;" >' + deal.dispensary + '</span><br><div style="display: inline-block; padding-left: 10px; padding-top: 6px" class="demo mb-5"> <button class="like like-custom" disabled=""><i class="fa fa-thumbs-up"></i> Likes <span class="likes">' + deal.likes + '</span> </button> <button class="dislike dislike-custom" disabled=""><i class="fa fa-thumbs-down"></i> Dislikes <span class="dislikes">' + deal.dislikes + '</span> </button> </div> </a></div>');
                }
              });

            document.getElementById("side_bar").innerHTML = side_bar_html;
            document.getElementById("js-list-view").innerHTML = list_view_html;
            $(".p-wrapper").dotdotdot({
                //	configuration goes her
                ellipsis    : '...',
                wrap		: 'word',
            });

        })
    }
</script>
<!--script  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAW0b9tbcJ6Sj4D31PLx5zfJ7WXItdOfsQ&libraries=places&callback=initialize" type="text/javascript"></script-->
<script  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAW0b9tbcJ6Sj4D31PLx5zfJ7WXItdOfsQ&libraries=places&callback=getLocation" type="text/javascript"></script>
<script src="{% static "main_app/vendors/jQuery.dotdotdot-master/src/jquery.dotdotdot.min.js" %}" ></script>

<script>
    $("#current").on('click', function(){
    var x = $('#searchTextField');

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else {
            x.val("Geolocation is not supported by this browser.");
        }
    }

    function showPosition(position) {
        x.val(position.coords.latitude + "  " + position.coords.longitude);
    }

    getLocation();
    })

</script>
<script>
    $('#js-select-view').on('change',function(){
        if ($(this).val() == '0'){
            $('#js-map-view').css({'display':'block'});
            $('#js-list-view').css({'display':'none'});
        }
        if ($(this).val() == '1'){
            $('#js-map-view').css({'display':'none'});
            $('#js-list-view').css({'display':'block'});
        }
    })
</script>
<script>
    function removeMarkers(){
        for(i=0; i<markers.length; i++){
            markers[i] = null;
        }
    }

    function sort_by_pk(a, b) {
        return b.pk -a.pk;
    }
    function sort_by_start_date(a, b) {
        return new Date(b.starts).getTime() - new Date(a.starts).getTime();
    }

    function sort_by_most_claimed(a, b) {
        return b.bought - a.bought;
    }

    $('#js-switch-sort').on('change', function(){
        var control = $(this);

        if(control.val() == '1') {
            newd = newd.sort(sort_by_start_date);
        }

        if(control.val() == '2'){
            newd = newd.sort(sort_by_most_claimed)
        }

        if(control.val() == '0'){
            side_bar_html = '';
            list_view_html = '';
            removeMarkers();
            featured.forEach(function (deal, i, newd) {
                if (deal.type == '1') {
                    createMarker({
                        lat: deal.lat,
                        lng: deal.lng
                    }, deal.title, deal.dispensary_city, deal.dispensary_state, deal.dispensary, deal.bought, deal.image_url, deal.likes, deal.dislikes, deal.deal_url, deal.price, deal.old_price, '<div style="min-width:270px"><a target="_blank" href="' + deal.deal_url + '" style="width: 100%; height: 100%; display: inline-block" ><img src="' + deal.image_url + '" alt="Logo" align="left" style="width: 80px; height: 80px"> <div class="p-wrapper" style="text-overflow:ellipsis; overflow:hidden; white-space:nowrap; max-width: 500px; display: inline-block; padding-left: 13px; vertical-align: top; padding-bottom: 8px; font-size: 20px">' + deal.title + '</div><br><span style="text-transform: uppercase; padding-left: 13px; font-weight: 400;" >' + deal.dispensary + '</span><br><div style="display: inline-block; padding-left: 10px; padding-top: 6px" class="demo mb-5"> <button class="like like-custom" disabled=""><i class="fa fa-thumbs-up"></i> Likes <span class="likes">' + deal.likes + '</span> </button> <button class="dislike dislike-custom" disabled=""><i class="fa fa-thumbs-down"></i> Dislikes <span class="dislikes">' + deal.dislikes + '</span> </button> </div> </a></div>');
                }
            });
            document.getElementById("side_bar").innerHTML = side_bar_html;
            document.getElementById("js-list-view").innerHTML = list_view_html;

            return false;
        }
        side_bar_html = '';
        list_view_html = '';
        removeMarkers();
        newd.forEach(function (deal, i, newd) {

        createMarker({
            lat: deal.lat,
            lng: deal.lng
        }, deal.title, deal.dispensary_city, deal.dispensary_state, deal.dispensary, deal.bought, deal.image_url, deal.likes, deal.dislikes, deal.deal_url, deal.price, deal.old_price, '<div style="min-width:270px"><a target="_blank" href="' + deal.deal_url + '" style="width: 100%; height: 100%; display: inline-block" ><img src="' + deal.image_url + '" alt="Logo" align="left" style="width: 80px; height: 80px"> <div class="p-wrapper" style="text-overflow:ellipsis; overflow:hidden; white-space:nowrap; max-width: 500px; display: inline-block; padding-left: 13px; vertical-align: top; padding-bottom: 8px; font-size: 20px">' + deal.title + '</div><br><span style="text-transform: uppercase; padding-left: 13px; font-weight: 400;" >' + deal.dispensary + '</span><br><div style="display: inline-block; padding-left: 10px; padding-top: 6px" class="demo mb-5"> <button class="like like-custom" disabled=""><i class="fa fa-thumbs-up"></i> Likes <span class="likes">' + deal.likes + '</span> </button> <button class="dislike dislike-custom" disabled=""><i class="fa fa-thumbs-down"></i> Dislikes <span class="dislikes">' + deal.dislikes + '</span> </button> </div> </a></div>');

        });
        document.getElementById("side_bar").innerHTML = side_bar_html;
        document.getElementById("js-list-view").innerHTML = list_view_html;
    });

    $('.js-categories li').on('click', function(){
        var li = $(this);
        var category_id = li.attr('id');
        var filter;
        if($('#js-switch-sort').val() == '5'){
            return false;
        } else {
            switch (category_id) {
                case '1':
                    filter = 'in';
                    break;
                case '2':
                    filter = 'sa';
                    break;
                case '3':
                    filter ='hy';
                    break;
                case '4':
                    filter = 'co';
                    break;
                case '5':
                    filter = 'ed';
                    break;
                case '6':
                    filter = 'cbd';
                    break;
            }

            newd = [];
            deals.forEach(function (deal, i) {
                if (deal.category == filter){
                    newd.push(deal);
                }

            })

            if($('#js-switch-sort').val() == '1') {
                newd = newd.sort(sort_by_start_date);
            }

            if($('#js-switch-sort').val() == '2'){
                newd = newd.sort(sort_by_most_claimed)
            }
        }
        side_bar_html = '';
        list_view_html = '';
        removeMarkers();
        newd.forEach(function (deal, i, newd) {
        createMarker({
            lat: deal.lat,
            lng: deal.lng
        }, deal.title, deal.dispensary_city, deal.dispensary_state, deal.dispensary, deal.bought, deal.image_url, deal.likes, deal.dislikes, deal.deal_url, deal.price, deal.old_price, '<div style="min-width:270px"><a target="_blank" href="' + deal.deal_url + '" style="width: 100%; height: 100%; display: inline-block" ><img src="' + deal.image_url + '" alt="Logo" align="left" style="width: 80px; height: 80px"> <div class="p-wrapper" style="text-overflow:ellipsis; overflow:hidden; white-space:nowrap; max-width: 500px; display: inline-block; padding-left: 13px; vertical-align: top; padding-bottom: 8px; font-size: 20px">' + deal.title + '</div><br><span style="text-transform: uppercase; padding-left: 13px; font-weight: 400;" >' + deal.dispensary + '</span><br><div style="display: inline-block; padding-left: 10px; padding-top: 6px" class="demo mb-5"> <button class="like like-custom" disabled=""><i class="fa fa-thumbs-up"></i> Likes <span class="likes">' + deal.likes + '</span> </button> <button class="dislike dislike-custom" disabled=""><i class="fa fa-thumbs-down"></i> Dislikes <span class="dislikes">' + deal.dislikes + '</span> </button> </div> </a></div>');

        });
        document.getElementById("side_bar").innerHTML = side_bar_html;
        document.getElementById("js-list-view").innerHTML = list_view_html;
        console.log(deals);
    })
</script>
</body>

</html>